name: AI Code Review on Comment
on:
  issue_comment:
    types: [created]

jobs:
  ai-code-review:
    # Only run on PR comments that contain "@review"
    if: github.event.issue.pull_request && contains(github.event.comment.body, '@review')
    runs-on: ubuntu-latest

    steps:
      - name: Checkout PR code
        uses: actions/checkout@v4
        with:
          # Checkout the PR branch, not the default branch
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: 0  # Needed for git diff operations

      - name: AI Code Review Analysis
        uses: 6529-Collections/ai-code-review-action@main
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          max-atomic-size: '15'  # Optional: adjust based on your needs
