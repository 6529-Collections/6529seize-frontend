import { render, screen } from "@testing-library/react";
import type { ReactNode } from "react";

jest.mock("next/link", () => ({
  __esModule: true,
  default: ({ href, children }: { href: string; children: ReactNode }) => (
    <a href={href}>{children}</a>
  ),
}));
jest.mock("@/components/user/utils/level/UserLevel", () => ({
  __esModule: true,
  default: () => <div data-testid="level" />,
}));
jest.mock("@/components/user/utils/user-cic-type/UserCICTypeIcon", () => ({
  __esModule: true,
  default: () => <div data-testid="cic-icon" />,
}));
jest.mock("@/helpers/Helpers", () => ({
  formatNumberWithCommasOrDash: (n: number) => `f${n}`,
  formatLargeNumber: (n: number) => `${n}M`,
  getTimeAgoShort: () => "2d",
}));
jest.mock("@/helpers/AllowlistToolHelpers", () => ({
  isEthereumAddress: () => false,
  isAutoGeneratedHandle: () => false,
}));
jest.mock("@/helpers/image.helpers", () => ({
  ImageScale: { W_AUTO_H_50: "50" },
  getScaledImageUri: (u: string) => u,
}));

import CommunityMembersMobileCard from "@/components/community/members-table/CommunityMembersMobileCard";

const member = {
  display: "Alice",
  detail_view_key: "alice",
  level: 1,
  tdh: 100,
  tdh_rate: 10,
  xtdh: 55,
  xtdh_rate: 5,
  combined_tdh: 150,
  combined_tdh_rate: 15,
  rep: 60,
  cic: 1,
  pfp: "url",
  last_activity: 10,
  wallet: "0x1",
} as any;

describe("CommunityMembersMobileCard", () => {
  it("renders member info and link", () => {
    render(<CommunityMembersMobileCard member={member} rank={2} />);
    expect(screen.getByText("#2")).toBeInTheDocument();
    expect(screen.getByText("Alice")).toBeInTheDocument();
    expect(screen.getByText("100M")).toBeInTheDocument();
    expect(screen.getByText("55M")).toBeInTheDocument();
    expect(screen.getByTestId("level")).toBeInTheDocument();
    expect(screen.getByTestId("cic-icon")).toBeInTheDocument();
    expect(screen.getByRole("link")).toHaveAttribute("href", "/alice");
    expect(screen.getByText("TDH")).toBeInTheDocument();
    expect(screen.getByText("xTDH")).toBeInTheDocument();
    expect(screen.getByText("REP")).toBeInTheDocument();
    expect(screen.getByText("NIC")).toBeInTheDocument();
    expect(screen.getByText("Last Seen")).toBeInTheDocument();
  });
});
