---
created: 2025-10-22
id: TKT-0010
owner: openai-assistant
priority: P1
status: In-Progress
title: Refactor WaveDropsAll component for modular clarity
---

## Context

> `components/waves/drops/WaveDropsAll.tsx` currently combines data derivation, layout branching, and repeated UI fragments in a single module. The Wave Drops surface needs to be refactored into reusable building blocks without changing behaviour, visuals, or the public API.

## Plan

- [x] Audit the existing WaveDropsAll component tree to catalogue UI regions, state, and derived data flows.
- [x] Draft modular breakdown covering subcomponents, hooks, and utilities aligned with the repo conventions.
- [x] Extract the new modules under `components/waves/drops/` while keeping behaviour and props stable.
- [x] Update the Wave Drops index composition shell to wire props → hooks → presentational pieces.
- [x] Run lint, type-check, and relevant tests to validate the refactor (currently failing upstream issues recorded below).

## Acceptance

- [x] `components/waves/drops/wave-drops-all/index.tsx` exposes the WaveDropsAll API and all consumers import from the feature folder.
- [x] Hooks, subcomponents, and utilities extracted into dedicated folders with feature prefixes (`WaveDrops*`).
- [x] Visual and behavioural parity verified for all states (loading, populated, empty).
- [x] TypeScript safety retained with no new `any` or weakened inference.

## Links

- Source file: `components/waves/drops/WaveDropsAll.tsx`
- [PR #1560](https://github.com/6529-Collections/6529seize-frontend/pull/1560)

## Log

- 2025-10-22T10:06:43Z – Ticket created for the WaveDropsAll modular refactor.
- 2025-10-22T10:11:24Z – Audited existing component logic and drafted breakdown: serial scroll controller hook, notification read hook, content and list subcomponents, and shared delay utility under `wave-drops-all/`.
- 2025-10-22T10:21:05Z – Extracted WaveDrops shell into `wave-drops-all/` modules (serial scroll hook, content/typing subcomponents, notification effect) and re-exported the stable entry point; `npm run test`, `npm run lint`, and `npm run type-check` were executed—each failing due to pre-existing test, lint, and type errors (e.g., drop Markdown link handler tests, lint unused imports in brain desktop, and TypeScript issues in legacy test suites).
- 2025-10-22T10:27:09Z – Removed legacy `components/waves/drops/WaveDropsAll.tsx` proxy and updated app/tests to import directly from `components/waves/drops/wave-drops-all`.
- 2025-10-22T11:07:16Z – Fixed WaveDrops content regression by gating the empty placeholder until virtualized drops hydrate; added Jest coverage for the loading state. `npm run test -- --runTestsByPath __tests__/components/waves/drops/WaveDropsAll.test.tsx` still fails on the existing onUserScroll assertion.
- 2025-10-22T11:18:04Z – Updated `parseSeizeQuoteLink` to accept both serial number and drop-based quote URLs and expanded unit tests (`npm run test -- --runTestsByPath __tests__/helpers/SeizeLinkParser.test.ts`) to cover the additional cases.
- 2025-10-22T11:21:14Z – Removed placeholder origin fallback from Seize quote parsing and documented the new requirement in `AGENTS.md`; `npm run test -- --runTestsByPath __tests__/helpers/SeizeLinkParser.test.ts` remains green.
- 2025-10-22T11:24:22Z – Normalized Seize quote parsing to trim trailing slashes from query values (wave, serial, drop) and added regression tests (`npm run test -- --runTestsByPath __tests__/helpers/SeizeLinkParser.test.ts`).
